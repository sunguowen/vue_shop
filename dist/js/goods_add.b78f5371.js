(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["goods_add"],{"0977":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[t._v("首页")]),a("el-breadcrumb-item",[t._v("商品管理")]),a("el-breadcrumb-item",[t._v("商品列表")])],1),a("el-card",{staticClass:"box-card"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-input",{staticClass:"input-with-select",attrs:{clearable:"",placeholder:"请输入内容"},on:{clear:t.getGoodsList},model:{value:t.queryInfo.query,callback:function(e){t.$set(t.queryInfo,"query",e)},expression:"queryInfo.query"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.getGoodsList},slot:"append"})],1)],1),a("el-col",{attrs:{span:4}},[a("el-button",{attrs:{type:"primary"},on:{click:t.goAddPage}},[t._v("添加商品")])],1)],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.goodsList,border:"",stripe:""}},[a("el-table-column",{attrs:{type:"index",label:"#"}}),a("el-table-column",{attrs:{prop:"goods_name",label:"商品名称"}}),a("el-table-column",{attrs:{prop:"goods_price",label:"商品价格(元)",width:"110px"}}),a("el-table-column",{attrs:{prop:"goods_weight",label:"商品重量",width:"100px"}}),a("el-table-column",{attrs:{label:"添加时间",width:"160px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("formatDate")(e.row.add_time)))]}}])}),a("el-table-column",{attrs:{label:"操作",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{icon:"el-icon-edit",type:"primary"}}),a("el-button",{attrs:{icon:"el-icon-delete",type:"danger"},on:{click:function(a){return t.deleteGoods(e.row)}}})]}}])})],1),a("el-pagination",{attrs:{"current-page":this.pagenum,"page-sizes":[10,20,30,40],"page-size":100,layout:"total, sizes, prev, pager, next, jumper",total:this.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)},o=[],s=(a("96cf"),a("1da1")),n={data:function(){return{queryInfo:{query:"",pagenum:"1",pagesize:"10"},goodsList:[],total:""}},created:function(){this.getGoodsList()},methods:{getGoodsList:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$http.get("goods",{params:t.queryInfo});case 2:if(a=e.sent,r=a.data,200===r.meta.status){e.next=6;break}return e.abrupt("return",t.$message.error(t.meta.msg));case 6:t.goodsList=r.data.goods,t.total=r.data.total;case 8:case"end":return e.stop()}}),e)})))()},handleCurrentChange:function(t){this.queryInfo.pagenum=t,this.getGoodsList()},handleSizeChange:function(t){this.queryInfo.pagesize=t,this.getGoodsList()},deleteGoods:function(t){var e=this;this.$confirm("确定永久删除这条商品信息吗？","提示",{confimrButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a=Object(s["a"])(regeneratorRuntime.mark((function a(r){var o,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,e.$http.delete("goods/"+t.goods_id);case 2:if(o=a.sent,s=o.data,200===s.meta.status){a.next=6;break}return a.abrupt("return",e.$message.error(s.meta.msg));case 6:e.$message.success(s.meta.msg),e.getGoodsList();case 8:case"end":return a.stop()}}),a)})));return function(t){return a.apply(this,arguments)}}()).catch((function(t){e.$message.info("您取消了此次删除操作")}))},goAddPage:function(){this.$router.push("/goods/add")}}},i=n,l=a("2877"),d=Object(l["a"])(i,r,o,!1,null,"a791022c",null);e["default"]=d.exports},"0e65":function(t,e,a){"use strict";var r=a("b7b9"),o=a.n(r);o.a},"159b":function(t,e,a){var r=a("da84"),o=a("fdbc"),s=a("17c2"),n=a("9112");for(var i in o){var l=r[i],d=l&&l.prototype;if(d&&d.forEach!==s)try{n(d,"forEach",s)}catch(c){d.forEach=s}}},"17c2":function(t,e,a){"use strict";var r=a("b727").forEach,o=a("a640"),s=a("ae40"),n=o("forEach"),i=s("forEach");t.exports=n&&i?[].forEach:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}},4160:function(t,e,a){"use strict";var r=a("23e7"),o=a("17c2");r({target:"Array",proto:!0,forced:[].forEach!=o},{forEach:o})},"4f9b":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[t._v("首页")]),a("el-breadcrumb-item",[t._v("商品管理")]),a("el-breadcrumb-item",[t._v("添加商品")])],1),a("el-card",[a("el-row",[a("el-alert",{attrs:{title:"添加商品信息",type:"info",center:"","show-icon":"",closable:!1}})],1),a("el-row",[a("el-steps",{attrs:{active:t.activeStep-0,"finish-status":"success","align-center":""}},[a("el-step",{attrs:{title:"基本信息"}}),a("el-step",{attrs:{title:"商品参数"}}),a("el-step",{attrs:{title:"商品属性"}}),a("el-step",{attrs:{title:"商品图片"}}),a("el-step",{attrs:{title:"商品内容"}}),a("el-step",{attrs:{title:"完成"}})],1)],1),a("el-form",{ref:"addGoodsFormRef",attrs:{model:t.addGoodsForm,rules:t.addGoodsFormRules,"label-width":"100px","label-position":"top"}},[a("el-tabs",{attrs:{"tab-position":"left","before-leave":t.beforeTabsLeave},on:{"tab-click":t.tabClick},model:{value:t.activeStep,callback:function(e){t.activeStep=e},expression:"activeStep"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"0"}},[a("el-form-item",{attrs:{label:"商品名称",prop:"goods_name"}},[a("el-input",{model:{value:t.addGoodsForm.goods_name,callback:function(e){t.$set(t.addGoodsForm,"goods_name",e)},expression:"addGoodsForm.goods_name"}})],1),a("el-form-item",{attrs:{label:"商品价格",prop:"goods_price"}},[a("el-input",{attrs:{type:"number"},model:{value:t.addGoodsForm.goods_price,callback:function(e){t.$set(t.addGoodsForm,"goods_price",e)},expression:"addGoodsForm.goods_price"}})],1),a("el-form-item",{attrs:{label:"商品重量",prop:"goods_weight"}},[a("el-input",{attrs:{type:"number"},model:{value:t.addGoodsForm.goods_weight,callback:function(e){t.$set(t.addGoodsForm,"goods_weight",e)},expression:"addGoodsForm.goods_weight"}})],1),a("el-form-item",{attrs:{label:"商品数量",prop:"goods_number"}},[a("el-input",{attrs:{type:"number"},model:{value:t.addGoodsForm.goods_number,callback:function(e){t.$set(t.addGoodsForm,"goods_number",e)},expression:"addGoodsForm.goods_number"}})],1),a("el-form-item",{attrs:{label:"商品分类",prop:"goods_cat"}},[a("el-cascader",{attrs:{options:t.cateList,props:t.props},on:{change:t.handleChange},model:{value:t.addGoodsForm.goods_cat,callback:function(e){t.$set(t.addGoodsForm,"goods_cat",e)},expression:"addGoodsForm.goods_cat"}})],1)],1),a("el-tab-pane",{attrs:{label:"商品参数",name:"1"}},t._l(t.manyTableData,(function(e){return a("el-form-item",{key:e.attr_id,attrs:{label:e.attr_name}},[a("el-checkbox-group",{model:{value:e.attr_vals,callback:function(a){t.$set(e,"attr_vals",a)},expression:"item.attr_vals"}},t._l(e.attr_vals,(function(t,e){return a("el-checkbox",{key:e,attrs:{border:"",label:t}})})),1)],1)})),1),a("el-tab-pane",{attrs:{label:"商品属性",name:"2"}},t._l(t.onlyTableData,(function(e){return a("el-form-item",{key:e.attr_id,attrs:{label:e.attr_name}},[a("el-input",{model:{value:e.attr_vals,callback:function(a){t.$set(e,"attr_vals",a)},expression:"item.attr_vals"}})],1)})),1),a("el-tab-pane",{attrs:{label:"商品图片",name:"3"}},[a("el-upload",{attrs:{action:t.uploadURL,"on-preview":t.handlePreview,"on-remove":t.handleRemove,"list-type":"picture",headers:t.headerObj,"on-success":t.handleSuccess}},[a("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v(" 只能上传jpg/png文件，且不超过500kb ")])],1)],1),a("el-tab-pane",{attrs:{label:"商品内容",name:"4"}},[a("quill-editor",{ref:"myQuillEditor",attrs:{options:t.editorOption},on:{blur:function(e){return t.onEditorBlur(e)},focus:function(e){return t.onEditorFocus(e)},ready:function(e){return t.onEditorReady(e)}},model:{value:t.addGoodsForm.goods_introduce,callback:function(e){t.$set(t.addGoodsForm,"goods_introduce",e)},expression:"addGoodsForm.goods_introduce"}}),a("el-button",{staticStyle:{marginTop:"20px"},attrs:{type:"primary"},on:{click:t.addGoods}},[t._v("添加商品")])],1)],1)],1)],1),a("el-dialog",{attrs:{title:"图片预览",visible:t.previewDialogVisible,width:"50%"},on:{"update:visible":function(e){t.previewDialogVisible=e}}},[a("span",[a("img",{staticStyle:{width:"100%"},attrs:{src:t.previewPath}})])])],1)},o=[],s=(a("c740"),a("4160"),a("a15b"),a("a434"),a("ac1f"),a("1276"),a("159b"),a("96cf"),a("1da1")),n=a("60bb"),i=a.n(n),l={data:function(){return{activeStep:"0",addGoodsForm:{goods_name:"",goods_price:0,goods_number:0,goods_weight:0,goods_cat:[],pics:[],goods_introduce:"",attrs:[]},addGoodsFormRules:{goods_name:[{required:!0,message:"商品名称不能为空",trigger:"blur"}],goods_price:[{required:!0,message:"商品价格不能为空",trigger:"blur"}],goods_number:[{required:!0,message:"商品数量不能为空",trigger:"blur"}],goods_weight:[{required:!0,message:"商品重量不能为空",trigger:"blur"}],goods_cat:[{required:!0,message:"您没有选择商品分类",trigger:"blur"}]},cateList:[],props:{expandTrigger:"hover",label:"cat_name",value:"cat_id",children:"children"},manyTableData:[],onlyTableData:[],uploadURL:"http://127.0.0.1:8888/api/private/v1/upload",headerObj:{Authorization:window.sessionStorage.getItem("token")},previewPath:"",previewDialogVisible:!1}},created:function(){this.getCateList()},methods:{getCateList:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$http.get("categories");case 2:if(a=e.sent,r=a.data,200===r.meta.status){e.next=6;break}return e.abrupt("return",t.$message.error("获取商品分类信息失败，这将导致分类选择框无法正常使用"));case 6:t.cateList=r.data;case 7:case"end":return e.stop()}}),e)})))()},handleChange:function(){3!==this.addGoodsForm.goods_cat.length&&(this.addGoodsForm.goods_cat=[])},beforeTabsLeave:function(t,e){if("0"===e&&3!==this.addGoodsForm.goods_cat.length)return this.$message.error("请先选择商品分类数据。"),!1},tabClick:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,r,o,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("1"!==t.activeStep){e.next=11;break}return e.next=3,t.$http.get("categories/"+t.cateID+"/attributes",{params:{sel:"many"}});case 3:if(a=e.sent,r=a.data,200===r.meta.status){e.next=7;break}return e.abrupt("return",t.$message.error(r.meta.msg));case 7:r.data.forEach((function(t){t.attr_vals=0===t.attr_vals.length?[]:t.attr_vals.split(",")})),t.manyTableData=r.data,e.next=19;break;case 11:if("2"!==t.activeStep){e.next=19;break}return e.next=14,t.$http.get("categories/"+t.cateID+"/attributes",{params:{sel:"only"}});case 14:if(o=e.sent,s=o.data,200===s.meta.status){e.next=18;break}return e.abrupt("return",t.$message.error(s.meta.msg));case 18:t.onlyTableData=s.data;case 19:case"end":return e.stop()}}),e)})))()},handlePreview:function(t){this.previewPath=t.response.data.url,this.previewDialogVisible=!0},handleRemove:function(t){var e=t.response.data.tmp_path,a=this.addGoodsForm.pics.findIndex((function(t){return t.pic===e}));this.addGoodsForm.pics.splice(a,1)},handleSuccess:function(t){var e={pic:t.data.tmp_path};this.addGoodsForm.pics.push(e)},addGoods:function(){var t=this;this.$refs.addGoodsFormRef.validate(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(a){var r,o,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return",t.$message.error("表单数据验证未通过！请检查"));case 2:return r=i.a.cloneDeep(t.addGoodsForm),r.goods_cat=r.goods_cat.join(","),t.manyTableData.forEach((function(e){var a={attr_id:e.attr_id,attr_value:e.attr_vals.join(",")};t.addGoodsForm.attrs.push(a)})),t.onlyTableData.forEach((function(e){var a={attr_id:e.attr_id,attr_value:e.attr_vals};t.addGoodsForm.attrs.push(a)})),r.attrs=t.addGoodsForm.attrs,e.next=9,t.$http.post("goods",r);case 9:if(o=e.sent,s=o.data,201===s.meta.status){e.next=13;break}return e.abrupt("return",t.$message.error(s.meta.msg));case 13:t.$message.success(s.meta.msg),t.$router.push("/goods");case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},computed:{cateID:function(){return 3===this.addGoodsForm.goods_cat.length?this.addGoodsForm.goods_cat[2]:null}}},d=l,c=(a("0e65"),a("2877")),u=Object(c["a"])(d,r,o,!1,null,"27434deb",null);e["default"]=u.exports},b7b9:function(t,e,a){},c740:function(t,e,a){"use strict";var r=a("23e7"),o=a("b727").findIndex,s=a("44d2"),n=a("ae40"),i="findIndex",l=!0,d=n(i);i in[]&&Array(1)[i]((function(){l=!1})),r({target:"Array",proto:!0,forced:l||!d},{findIndex:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),s(i)},fdbc:function(t,e){t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}}}]);
//# sourceMappingURL=goods_add.b78f5371.js.map